<html>
<head>
</head>

<body>


<h1 id="users"></h1>

<h2 id="message2"></h2>

<button onload="send()" onclick="myFunction()">Clear the canvas</button> 

<input type="range" min="1" max="255" value="50" class="slider" id="red">
<input type="range" min="1" max="255" value="50" class="slider2" id="green">
<input type="range" min="1" max="255" value="50" class="slider3" id="blue">

<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js" integrity="sha512-NxocnqsXP3zm0Xb42zqVMvjQIktKEpTIbCXXyhBPxqGZHqhcOXHs4pXI/GoZ8lE+2NJONRifuBpi9DxC58L0Lw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>

let user = prompt('Enter a username')
while(user === "null"){
  user = prompt('enter a username')
}

var colour = 0

var users

var sred
var sgreen
var sblue

var RED2
var GREEN2
var BLUE2

let RED = prompt('Enter a red rgb value')
while(RED > 255){
  RED = prompt('nonono enter a number between 1 and 255')
}

let GREEN = prompt('Enter a green rgb value')
while(GREEN > 255){
  GREEN = prompt('nonono enter a number between 1 and 255')
}

let BLUE = prompt('Enter a blue rgb value')
while(BLUE > 255){
  BLUE = prompt('nonono enter a number between 1 and 255')
}

document.getElementById("red").oninput = function() {
    myFunction2()
};

function myFunction2() {
   var val = document.getElementById("red").value //gets the oninput value
  //  console.log(val)
   RED = val
}

document.getElementById("blue").oninput = function() {
    myFunction3()
};

function myFunction3() {
   var val = document.getElementById("blue").value //gets the oninput value
  //  console.log(val)
   BLUE = val
}

document.getElementById("green").oninput = function() {
    myFunction4()
};

function myFunction4() {
   var val = document.getElementById("green").value //gets the oninput value
  //  console.log(val)
   GREEN = val
}

var socket;

function myFunction(){
  var clear2 = 0
  clear();
  background(51)

  socket.emit('clear', clear2)

  socket.emit('refresh', 'refresh please')
}

function setup(){
  createCanvas(6000, 3333);
  background(51)

  socket = io.connect('http://pinky.uk.to:5000')
  socket.on('incords', Pinky)
  socket.on('sketch', start)
  socket.on('reload', yes)
  socket.on('connection', colouring)
  socket.on('users', init1)
  socket.on('newrgb', rgb)
}

function rgb(number1,number2,number3){
  sred = number1
  sgreen = number2
  sblue = number3
  // console.log("client: "+number1+" "+number2+" "+number3)
}

function init1(data){
  document.getElementById('users').innerHTML = data.username
  // console.log(data)
}

function colouring(data){
  console.log(data)
  socket.emit('username', user)
  setInterval(() => {
    socket.emit('rgb', RED, GREEN, BLUE)
    
  }, 1500);
}

function printthis(data){
  console.log(data)
}

function yes(data){
  alert(data)
}

function start(data){
  for (let i = 0; i < data.length; i++) {
  // console.log(data[i]);
  noStroke()
  fill(100,0,100)
  setTimeout(() => {
    ellipse(data[i].x, data[i].y, 36, 36)
  }, 3000);
}}

// websocket data
function Pinky(data){
    noStroke()
    fill(sred,sgreen,sblue)
    ellipse(data.x, data.y, 36, 36)
}

// client drawing
function mouseDragged(){

  var data = {
    x: mouseX,
    y: mouseY
  }

  socket.emit('mouse', data)

  noStroke()
  fill(RED,GREEN,BLUE)
  ellipse(mouseX, mouseY, 36, 36)
}



</script>
</body>
</html>